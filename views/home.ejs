<div id="home-container" class="container mx-auto">
    <div class="flex flex-col lg:flex-row gap-6">
        <!-- Left Sidebar - Only on Large Screens -->
        <div class="hidden lg:block lg:w-1/4">
            <div class="bg-white rounded-lg shadow-md p-4 sticky top-20">
                <div class="flex items-center space-x-3 mb-6">
                    <% if (locals.user) { %>
                        <div class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-400 to-cyan-400 flex items-center justify-center text-white font-bold">
                            <%= locals.user.name.charAt(0).toUpperCase() %>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-800"><%= locals.user.name %></h3>
                            <p class="text-xs text-gray-500">Online</p>
                        </div>
                    <% } else { %>
                        <div class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center text-gray-500">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-800">Guest</h3>
                            <a href="/users/sign-in" class="text-xs text-blue-500">Sign in</a>
                        </div>
                    <% } %>
                </div>
                
                <ul class="space-y-2">
                    <li>
                        <a href="/" class="flex items-center space-x-3 p-2 rounded-md bg-blue-50 text-blue-600">
                            <i class="fas fa-home"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center space-x-3 p-2 rounded-md hover:bg-gray-100 text-gray-700 transition-colors duration-300">
                            <i class="fas fa-bell"></i>
                            <span>Notifications</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center space-x-3 p-2 rounded-md hover:bg-gray-100 text-gray-700 transition-colors duration-300">
                            <i class="fas fa-envelope"></i>
                            <span>Messages</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center space-x-3 p-2 rounded-md hover:bg-gray-100 text-gray-700 transition-colors duration-300">
                            <i class="fas fa-bookmark"></i>
                            <span>Bookmarks</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center space-x-3 p-2 rounded-md hover:bg-gray-100 text-gray-700 transition-colors duration-300">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="w-full lg:w-2/4">
            <section id="feed-posts" class="mb-6">
                <% if (locals.user) { %>
                    <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-400 to-cyan-400 flex items-center justify-center text-white font-bold">
                                <%= locals.user.name.charAt(0).toUpperCase() %>
                            </div>
                            <h3 class="text-lg font-medium text-gray-800">Create a Post</h3>
                        </div>
                        
                        <form action="/posts/create" method="post" id="new-post-form">
                            <textarea name="content" rows="3" 
                                placeholder="What's on your mind?" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent resize-none mb-3"
                                required></textarea>
                            
                            <div class="flex justify-between items-center">
                                <div class="flex space-x-3">
                                    <button type="button" class="flex items-center text-gray-600 hover:text-blue-500 transition-colors duration-300">
                                        <i class="fas fa-image mr-1"></i>
                                        <span class="text-sm">Photo</span>
                                    </button>
                                    <button type="button" class="flex items-center text-gray-600 hover:text-blue-500 transition-colors duration-300">
                                        <i class="fas fa-video mr-1"></i>
                                        <span class="text-sm">Video</span>
                                    </button>
                                </div>
                                
                                <button type="submit" class="bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white px-6 py-2 rounded-lg transition duration-300 shadow-sm">
                                    Post
                                </button>
                            </div>
                        </form>
                    </div>
                <% } %>

                <div id="posts-list-container">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-stream mr-2 text-blue-500"></i>
                        Latest Posts
                    </h3>
                    
                    <ul>
                        <% for(post of posts) { %>
                            <%- include('_post') -%>
                        <% } %>
                    </ul>
                </div>
            </section>
        </div>
        
        <!-- Right Sidebar -->
        <div class="w-full lg:w-1/4">
            <section id="user-friends" class="bg-white rounded-lg shadow-md p-4 sticky top-20">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-users mr-2 text-blue-500"></i>
                    Friends
                </h3>
                
                <% if (all_users && all_users.length > 0) { %>
                    <ul class="divide-y divide-gray-100">
                        <% for(u of all_users) { %>
                            <li class="py-3 first:pt-0 last:pb-0">
                                <a href="/users/profile/<%= u.id %>" class="flex items-center space-x-3 hover:bg-gray-50 p-2 rounded-md transition-colors duration-300">
                                    <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600">
                                        <%= u.name.charAt(0).toUpperCase() %>
                                    </div>
                                    <span class="font-medium text-gray-700"><%= u.name %></span>
                                </a>
                            </li>
                        <% } %>
                    </ul>
                <% } else { %>
                    <p class="text-gray-500 text-center py-4">No friends found</p>
                <% } %>
                
                <div class="mt-4 pt-3 border-t border-gray-100">
                    <a href="#" class="flex items-center justify-center text-blue-500 hover:text-blue-600 transition-colors duration-300">
                        <i class="fas fa-user-plus mr-1"></i>
                        <span>Find More Friends</span>
                    </a>
                </div>
            </section>
        </div>
    </div>
</div>

<script src="/js/post_comments.js"></script>
<script src="/js/home_posts.js"></script>
<script src="/js/toggle_likes.js"></script>

<script>
    // Add animation for comment toggle
    document.querySelectorAll('.comment-toggle').forEach(button => {
        button.addEventListener('click', function() {
            const postId = this.closest('li').id.split('-')[1];
            const commentsList = document.getElementById(`post-comments-${postId}`);
            commentsList.closest('.post-comments').classList.toggle('hidden');
        });
    });

    // Initialize with comments hidden if there are more than 0 comments
    document.querySelectorAll('.post-comments').forEach(commentSection => {
        const comments = commentSection.querySelectorAll('li');
        if (comments.length > 0) {
            // Don't hide initially, but setup toggle
        }
    });
</script>